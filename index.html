<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NBA Career Journey Map</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Source+Sans+3:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #1d428a;
            --secondary: #c8102e;
            --gold: #fdb927;
            --dark: #0a0a0a;
            --light: #f8f9fa;
            --gray: #6c757d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Source Sans 3', sans-serif;
            background: var(--dark);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, #0d2240 100%);
            padding: 1rem;
            border-bottom: 3px solid var(--secondary);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        
        h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            letter-spacing: 2px;
            color: var(--light);
        }
        
        h1 span {
            color: var(--gold);
        }
        
        /* Search Container */
        .search-container {
            position: relative;
            width: 100%;
            max-width: 350px;
        }
        
        #searchInput {
            width: 100%;
            padding: 0.7rem 1rem;
            font-size: 1rem;
            border: none;
            border-radius: 50px;
            background: rgba(255,255,255,0.95);
            color: var(--dark);
            outline: none;
        }
        
        #searchInput:focus {
            box-shadow: 0 0 0 3px var(--gold);
        }
        
        #suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
            max-height: 250px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        
        #suggestions.active {
            display: block;
        }
        
        .suggestion-item {
            padding: 0.7rem 1rem;
            cursor: pointer;
            color: var(--dark);
            border-bottom: 1px solid #eee;
        }
        
        .suggestion-item:hover, .suggestion-item:active {
            background: var(--gold);
        }
        
        /* Main Layout - Mobile First */
        .main-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 70px);
            height: calc(100dvh - 70px);
        }
        
        /* Map */
        #map {
            width: 100%;
            height: 45%;
            min-height: 250px;
            background: #1a1a2e;
        }
        
        /* Sidebar */
        .sidebar {
            flex: 1;
            background: linear-gradient(180deg, #1a1a1a 0%, #0d0d0d 100%);
            padding: 1rem;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .player-info {
            display: none;
        }
        
        .player-info.active {
            display: block;
        }
        
        .player-name {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.6rem;
            letter-spacing: 2px;
            color: var(--gold);
            margin-bottom: 0.3rem;
        }
        
        .player-meta {
            color: var(--gray);
            font-size: 0.85rem;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #333;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .stat-box {
            background: rgba(255,255,255,0.05);
            padding: 0.6rem 0.4rem;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #333;
        }
        
        .stat-value {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.4rem;
            color: var(--gold);
        }
        
        .stat-label {
            font-size: 0.65rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .career-timeline {
            margin-top: 1rem;
        }
        
        .timeline-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 1px;
            color: var(--light);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .timeline-title::before {
            content: '';
            width: 4px;
            height: 18px;
            background: var(--secondary);
        }
        
        .timeline-item {
            display: flex;
            gap: 0.75rem;
            position: relative;
            padding-left: 2.5rem;
            cursor: pointer;
            transition: background 0.2s;
            margin: 0 -1rem;
            padding-right: 1rem;
        }
        
        .timeline-item:hover, .timeline-item.highlighted {
            background: rgba(253, 185, 39, 0.1);
        }
        
        .timeline-item.highlighted {
            background: rgba(253, 185, 39, 0.2);
        }
        
        .stop-number {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 22px;
            height: 22px;
            background: var(--secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.75rem;
            color: white;
            border: 2px solid var(--dark);
        }
        
        .timeline-item:first-child .stop-number {
            background: var(--gold);
            color: var(--dark);
        }
        
        .timeline-item:last-child .stop-number {
            background: var(--primary);
        }
        
        .timeline-content {
            flex: 1;
            padding: 0.75rem 0;
            border-bottom: 1px solid #222;
        }
        
        .timeline-item:last-child .timeline-content {
            border-bottom: none;
        }
        
        .timeline-years {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9rem;
            color: var(--gold);
            letter-spacing: 1px;
        }
        
        .timeline-team {
            font-weight: 600;
            color: var(--light);
            margin: 0.2rem 0;
            text-decoration: underline;
            text-decoration-color: rgba(255,255,255,0.3);
            text-underline-offset: 2px;
        }
        
        .timeline-team:hover {
            color: var(--gold);
            text-decoration-color: var(--gold);
        }
        
        .timeline-location {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        /* Welcome Message */
        .welcome-message {
            text-align: center;
            padding: 2rem 1rem;
            color: var(--gray);
        }
        
        .welcome-message h2 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            color: var(--light);
            margin-bottom: 0.75rem;
        }
        
        .welcome-message p {
            font-size: 0.85rem;
            line-height: 1.5;
        }
        
        /* Suggested Players */
        .suggested-players {
            margin-top: 1.5rem;
        }
        
        .suggested-players h3 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            color: var(--gold);
            margin-bottom: 0.75rem;
            letter-spacing: 1px;
        }
        
        .player-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .player-chip {
            background: rgba(255,255,255,0.1);
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #333;
        }
        
        .player-chip:hover, .player-chip:active {
            background: var(--gold);
            color: var(--dark);
            border-color: var(--gold);
        }
        
        /* Team Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background: #1a1a1a;
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            overflow: hidden;
            border: 2px solid var(--secondary);
        }
        
        .modal-header {
            background: var(--primary);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            letter-spacing: 1px;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }
        
        .modal-body {
            padding: 1rem;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .modal-team-location {
            color: var(--gray);
            font-size: 0.85rem;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #333;
        }
        
        .modal-player-count {
            color: var(--gold);
            font-size: 0.85rem;
            margin-bottom: 0.75rem;
        }
        
        .modal-player-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .modal-player-item {
            padding: 0.5rem 0.75rem;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 0.9rem;
        }
        
        .modal-player-item:hover {
            background: rgba(253, 185, 39, 0.2);
        }
        
        .modal-player-years {
            color: var(--gray);
            font-size: 0.75rem;
        }
        
        /* Custom Map Markers with Numbers */
        .numbered-marker {
            background: var(--secondary);
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 12px;
            color: white;
        }
        
        .numbered-marker.start {
            background: var(--gold);
            color: var(--dark);
        }
        
        .numbered-marker.end {
            background: var(--primary);
        }
        
        .numbered-marker.highlighted {
            transform: scale(1.3);
            box-shadow: 0 0 15px var(--gold);
            z-index: 1000 !important;
        }
        
        /* Map Popup */
        .leaflet-popup-content-wrapper {
            background: var(--dark);
            color: var(--light);
            border-radius: 8px;
            border: 2px solid var(--secondary);
        }
        
        .leaflet-popup-tip {
            background: var(--dark);
        }
        
        .popup-content {
            padding: 0.3rem;
        }
        
        .popup-stop {
            font-family: 'Bebas Neue', sans-serif;
            color: var(--gold);
            font-size: 0.85rem;
        }
        
        .popup-team {
            font-weight: 600;
            margin: 0.2rem 0;
            font-size: 0.9rem;
        }
        
        .popup-location {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .popup-years {
            font-size: 0.8rem;
            color: var(--secondary);
            margin-top: 0.2rem;
        }
        
        /* Map Legend */
        .map-legend {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-size: 0.7rem;
            z-index: 1000;
            display: flex;
            gap: 0.75rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
        }
        
        .legend-dot.start { background: var(--gold); }
        .legend-dot.middle { background: var(--secondary); }
        .legend-dot.end { background: var(--primary); }
        
        /* Desktop */
        @media (min-width: 768px) {
            header {
                padding: 1.25rem 2rem;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .main-container {
                flex-direction: row;
                height: calc(100vh - 85px);
            }
            
            .sidebar {
                width: 380px;
                min-width: 380px;
                order: -1;
            }
            
            #map {
                flex: 1;
                height: 100%;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .player-name {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>NBA <span>CAREER</span> MAP</h1>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Search for a player..." autocomplete="off">
                <div id="suggestions"></div>
            </div>
        </div>
    </header>
    
    <div class="main-container">
        <div id="map">
            <div class="map-legend">
                <div class="legend-item"><div class="legend-dot start"></div> First</div>
                <div class="legend-item"><div class="legend-dot middle"></div> Stop</div>
                <div class="legend-item"><div class="legend-dot end"></div> Latest</div>
            </div>
        </div>
        
        <aside class="sidebar">
            <div class="welcome-message" id="welcomeMessage">
                <h2>üèÄ Explore Player Journeys</h2>
                <p>Search for any NBA player to see their career trajectory mapped across the globe.</p>
                
                <div class="suggested-players">
                    <h3>‚≠ê Suggested Players</h3>
                    <div class="player-chips" id="suggestedChips"></div>
                </div>
            </div>
            
            <div class="player-info" id="playerInfo">
                <h2 class="player-name" id="playerName"></h2>
                <p class="player-meta" id="playerMeta"></p>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="statTeams">-</div>
                        <div class="stat-label">Teams</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="statCountries">-</div>
                        <div class="stat-label">Countries</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="statYears">-</div>
                        <div class="stat-label">Years</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="statStops">-</div>
                        <div class="stat-label">Stops</div>
                    </div>
                </div>
                
                <div class="career-timeline">
                    <h3 class="timeline-title">Career Timeline</h3>
                    <div id="timeline"></div>
                </div>
                
                <div class="suggested-players" style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #333;">
                    <h3>üîç Try Another Player</h3>
                    <div class="player-chips" id="moreSuggestions"></div>
                </div>
            </div>
        </aside>
    </div>
    
    <!-- Team Modal -->
    <div class="modal-overlay" id="teamModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTeamName">Team Name</h3>
                <button class="modal-close" onclick="closeTeamModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-team-location" id="modalTeamLocation"></div>
                <div class="modal-player-count" id="modalPlayerCount"></div>
                <div class="modal-player-list" id="modalPlayerList"></div>
            </div>
        </div>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Suggested star players (1985+)
        const SUGGESTED_PLAYERS = [
            "LeBron James", "Michael Jordan", "Kobe Bryant", "Stephen Curry",
            "Kevin Durant", "Shaquille O'Neal", "Tim Duncan", "Magic Johnson",
            "Larry Bird", "Dirk Nowitzki", "Kevin Garnett", "Allen Iverson",
            "Dwyane Wade", "Chris Paul", "Giannis Antetokounmpo", "Luka Donƒçiƒá",
            "Hakeem Olajuwon", "Charles Barkley", "Karl Malone", "John Stockton",
            "Patrick Ewing", "Scottie Pippen", "Gary Payton", "Jason Kidd",
            "Steve Nash", "Ray Allen", "Paul Pierce", "Vince Carter",
            "Tracy McGrady", "Carmelo Anthony", "Russell Westbrook", "James Harden",
            "Kawhi Leonard", "Anthony Davis", "Nikola Jokiƒá", "Joel Embiid"
        ];
        
        // City coordinates database
        const CITY_COORDS = {
            // NBA Cities - USA
            "New York|New York|USA": [40.7128, -74.0060],
            "Brooklyn|New York|USA": [40.6782, -73.9442],
            "Los Angeles|California|USA": [34.0522, -118.2437],
            "Chicago|Illinois|USA": [41.8781, -87.6298],
            "Houston|Texas|USA": [29.7604, -95.3698],
            "Phoenix|Arizona|USA": [33.4484, -112.0740],
            "Philadelphia|Pennsylvania|USA": [39.9526, -75.1652],
            "San Antonio|Texas|USA": [29.4241, -98.4936],
            "San Diego|California|USA": [32.7157, -117.1611],
            "Dallas|Texas|USA": [32.7767, -96.7970],
            "Austin|Texas|USA": [30.2672, -97.7431],
            "Charlotte|North Carolina|USA": [35.2271, -80.8431],
            "San Francisco|California|USA": [37.7749, -122.4194],
            "Indianapolis|Indiana|USA": [39.7684, -86.1581],
            "Seattle|Washington|USA": [47.6062, -122.3321],
            "Denver|Colorado|USA": [39.7392, -104.9903],
            "Boston|Massachusetts|USA": [42.3601, -71.0589],
            "Detroit|Michigan|USA": [42.3314, -83.0458],
            "Portland|Oregon|USA": [45.5152, -122.6784],
            "Memphis|Tennessee|USA": [35.1495, -90.0490],
            "Oklahoma City|Oklahoma|USA": [35.4676, -97.5164],
            "Milwaukee|Wisconsin|USA": [43.0389, -87.9065],
            "Atlanta|Georgia|USA": [33.7490, -84.3880],
            "Sacramento|California|USA": [38.5816, -121.4944],
            "Miami|Florida|USA": [25.7617, -80.1918],
            "Orlando|Florida|USA": [28.5383, -81.3792],
            "Minneapolis|Minnesota|USA": [44.9778, -93.2650],
            "Cleveland|Ohio|USA": [41.4993, -81.6944],
            "New Orleans|Louisiana|USA": [29.9511, -90.0715],
            "Salt Lake City|Utah|USA": [40.7608, -111.8910],
            "Washington|D.C.|USA": [38.9072, -77.0369],
            "Baltimore|Maryland|USA": [39.2904, -76.6122],
            "East Rutherford|New Jersey|USA": [40.8128, -74.0742],
            "Oakland|California|USA": [37.8044, -122.2712],
            
            // G-League & Minor League
            "Sioux Falls|South Dakota|USA": [43.5446, -96.7311],
            "Boise|Idaho|USA": [43.6150, -116.2023],
            "Frisco|Texas|USA": [33.1507, -96.8236],
            "Edinburg|Texas|USA": [26.3017, -98.1633],
            "Stockton|California|USA": [37.9577, -121.2908],
            "Reno|Nevada|USA": [39.5296, -119.8138],
            "Fort Wayne|Indiana|USA": [41.0793, -85.1394],
            "Santa Cruz|California|USA": [36.9741, -122.0308],
            "Grand Rapids|Michigan|USA": [42.9634, -85.6681],
            "Erie|Pennsylvania|USA": [42.1292, -80.0851],
            "Canton|Ohio|USA": [40.7989, -81.3784],
            "Greensboro|North Carolina|USA": [36.0726, -79.7920],
            "Las Vegas|Nevada|USA": [36.1699, -115.1398],
            "Rapid City|South Dakota|USA": [44.0805, -103.2310],
            "Rockford|Illinois|USA": [42.2711, -89.0940],
            "Albany|New York|USA": [42.6526, -73.7562],
            "Buffalo|New York|USA": [42.8864, -78.8784],
            "Kansas City|Missouri|USA": [39.0997, -94.5786],
            "St. Louis|Missouri|USA": [38.6270, -90.1994],
            "Louisville|Kentucky|USA": [38.2527, -85.7585],
            "Columbus|Ohio|USA": [39.9612, -82.9988],
            "Cincinnati|Ohio|USA": [39.1031, -84.5120],
            "Pittsburgh|Pennsylvania|USA": [40.4406, -79.9959],
            "Hartford|Connecticut|USA": [41.7658, -72.6734],
            
            // Canada
            "Toronto|Ontario|Canada": [43.6532, -79.3832],
            "Vancouver|British Columbia|Canada": [49.2827, -123.1207],
            "Montreal|Quebec|Canada": [45.5017, -73.5673],
            
            // Europe - Spain
            "Madrid||Spain": [40.4168, -3.7038],
            "Barcelona||Spain": [41.3851, 2.1734],
            "Valencia||Spain": [39.4699, -0.3763],
            "Sevilla||Spain": [37.3891, -5.9845],
            "Bilbao||Spain": [43.2630, -2.9350],
            "M√°laga||Spain": [36.7213, -4.4214],
            "Zaragoza||Spain": [41.6488, -0.8891],
            "Vitoria-Gasteiz||Spain": [42.8467, -2.6716],
            "Badalona||Spain": [41.4500, 2.2475],
            "Tenerife||Spain": [28.4636, -16.2518],
            
            // Europe - Italy
            "Rome||Italy": [41.9028, 12.4964],
            "Roma||Italy": [41.9028, 12.4964],
            "Milan||Italy": [45.4642, 9.1900],
            "Milano||Italy": [45.4642, 9.1900],
            "Bologna||Italy": [44.4949, 11.3426],
            "Venice||Italy": [45.4408, 12.3155],
            "Venezia||Italy": [45.4408, 12.3155],
            "Siena||Italy": [43.3188, 11.3308],
            "Treviso||Italy": [45.6669, 12.2430],
            "Cant√π||Italy": [45.7390, 9.1322],
            "Varese||Italy": [45.8206, 8.8257],
            
            // Europe - Greece
            "Athens||Greece": [37.9838, 23.7275],
            "Piraeus||Greece": [37.9475, 23.6412],
            "Thessaloniki||Greece": [40.6401, 22.9444],
            
            // Europe - Turkey
            "Istanbul||Turkey": [41.0082, 28.9784],
            "Ankara||Turkey": [39.9334, 32.8597],
            "ƒ∞zmir||Turkey": [38.4237, 27.1428],
            
            // Europe - France
            "Paris||France": [48.8566, 2.3522],
            "Lyon||France": [45.7640, 4.8357],
            "Villeurbanne||France": [45.7676, 4.8798],
            "Limoges||France": [45.8336, 1.2611],
            
            // Europe - Germany
            "Berlin||Germany": [52.5200, 13.4050],
            "Munich||Germany": [48.1351, 11.5820],
            "Frankfurt||Germany": [50.1109, 8.6821],
            "Bamberg||Germany": [49.8988, 10.9028],
            
            // Europe - Russia
            "Moscow||Russia": [55.7558, 37.6173],
            "Saint Petersburg||Russia": [59.9311, 30.3609],
            
            // Europe - Eastern
            "Belgrade||Serbia": [44.7866, 20.4489],
            "Zagreb||Croatia": [45.8150, 15.9819],
            "Ljubljana||Slovenia": [46.0569, 14.5058],
            "Kaunas||Lithuania": [54.8985, 23.9036],
            "Vilnius||Lithuania": [54.6872, 25.2797],
            "Tel Aviv||Israel": [32.0853, 34.7818],
            
            // Asia
            "Beijing||China": [39.9042, 116.4074],
            "Shanghai||China": [31.2304, 121.4737],
            "Guangzhou||China": [23.1291, 113.2644],
            "Tokyo||Japan": [35.6762, 139.6503],
            "Seoul||South Korea": [37.5665, 126.9780],
            "Manila||Philippines": [14.5995, 120.9842],
            "Taipei||Taiwan": [25.0330, 121.5654],
            
            // Oceania
            "Sydney|New South Wales|Australia": [-33.8688, 151.2093],
            "Melbourne|Victoria|Australia": [-37.8136, 144.9631],
            "Perth|Western Australia|Australia": [-31.9505, 115.8605],
            "Auckland||New Zealand": [-36.8509, 174.7645],
            
            // Americas
            "Mexico City||Mexico": [19.4326, -99.1332],
            "S√£o Paulo||Brazil": [-23.5505, -46.6333],
            "Buenos Aires||Argentina": [-34.6037, -58.3816],
            "San Juan||Puerto Rico": [18.4655, -66.1057],
            "Bayam√≥n||Puerto Rico": [18.3833, -66.1500],
            "Santo Domingo||Dominican Republic": [18.4861, -69.9312],
        };
        
        // Country fallback
        const COUNTRY_COORDS = {
            "USA": [39.8283, -98.5795],
            "Canada": [56.1304, -106.3468],
            "Spain": [40.4637, -3.7492],
            "Italy": [41.8719, 12.5674],
            "France": [46.2276, 2.2137],
            "Germany": [51.1657, 10.4515],
            "Greece": [39.0742, 21.8243],
            "Turkey": [38.9637, 35.2433],
            "Russia": [61.5240, 105.3188],
            "Serbia": [44.0165, 21.0059],
            "Croatia": [45.1000, 15.2000],
            "Slovenia": [46.1512, 14.9955],
            "Lithuania": [55.1694, 23.8813],
            "Israel": [31.0461, 34.8516],
            "China": [35.8617, 104.1954],
            "Japan": [36.2048, 138.2529],
            "South Korea": [35.9078, 127.7669],
            "Philippines": [12.8797, 121.7740],
            "Australia": [-25.2744, 133.7751],
            "New Zealand": [-40.9006, 174.8860],
            "Puerto Rico": [18.2208, -66.5901],
            "Argentina": [-38.4161, -63.6167],
            "Brazil": [-14.2350, -51.9253],
            "Mexico": [23.6345, -102.5528],
            "Dominican Republic": [18.7357, -70.1627],
            "Venezuela": [6.4238, -66.5897],
            "Poland": [51.9194, 19.1451],
            "Ukraine": [48.3794, 31.1656],
            "Belgium": [50.5039, 4.4699],
            "Montenegro": [42.7087, 19.3744],
            "Lebanon": [33.8547, 35.8623],
            "UAE": [23.4241, 53.8478],
            "Iran": [32.4279, 53.6880],
        };
        
        // Flags
        const FLAGS = {
            "USA": "üá∫üá∏", "Canada": "üá®üá¶", "Spain": "üá™üá∏", "Italy": "üáÆüáπ", "France": "üá´üá∑",
            "Germany": "üá©üá™", "Greece": "üá¨üá∑", "Turkey": "üáπüá∑", "Russia": "üá∑üá∫", "Serbia": "üá∑üá∏",
            "Croatia": "üá≠üá∑", "Slovenia": "üá∏üáÆ", "Lithuania": "üá±üáπ", "Latvia": "üá±üáª", "Estonia": "üá™üá™",
            "Israel": "üáÆüá±", "China": "üá®üá≥", "Japan": "üáØüáµ", "South Korea": "üá∞üá∑", "Taiwan": "üáπüáº",
            "Philippines": "üáµüá≠", "Australia": "üá¶üá∫", "New Zealand": "üá≥üáø",
            "Puerto Rico": "üáµüá∑", "Argentina": "üá¶üá∑", "Brazil": "üáßüá∑", "Venezuela": "üáªüá™",
            "Mexico": "üá≤üáΩ", "Poland": "üáµüá±", "Ukraine": "üá∫üá¶", "Belgium": "üáßüá™",
            "Netherlands": "üá≥üá±", "Portugal": "üáµüáπ", "Montenegro": "üá≤üá™", "Bosnia": "üáßüá¶",
            "Bulgaria": "üáßüá¨", "Romania": "üá∑üá¥", "Hungary": "üá≠üá∫", "Czech Republic": "üá®üáø",
            "Austria": "üá¶üáπ", "Switzerland": "üá®üá≠", "Sweden": "üá∏üá™", "Finland": "üá´üáÆ",
            "Denmark": "üá©üá∞", "Norway": "üá≥üá¥", "United Kingdom": "üá¨üáß", "Ireland": "üáÆüá™",
            "Cyprus": "üá®üáæ", "Lebanon": "üá±üáß", "UAE": "üá¶üá™", "Saudi Arabia": "üá∏üá¶",
            "Kuwait": "üá∞üáº", "Qatar": "üá∂üá¶", "Iran": "üáÆüá∑",
            "Dominican Republic": "üá©üá¥", "Uruguay": "üá∫üáæ", "Chile": "üá®üá±", "Colombia": "üá®üá¥",
            "Egypt": "üá™üá¨", "Morocco": "üá≤üá¶", "Nigeria": "üá≥üá¨", "South Africa": "üáøüá¶",
            "Senegal": "üá∏üá≥", "Angola": "üá¶üá¥", "Georgia": "üá¨üá™", "Kazakhstan": "üá∞üáø",
        };
        
        function getFlag(country) {
            return FLAGS[country] || 'üåç';
        }
        
        function getCoords(city, state, country) {
            if (!city) return null;
            
            const key1 = `${city}|${state || ''}|${country || ''}`;
            if (CITY_COORDS[key1]) return CITY_COORDS[key1];
            
            const key2 = `${city}||${country || ''}`;
            if (CITY_COORDS[key2]) return CITY_COORDS[key2];
            
            if (country && COUNTRY_COORDS[country]) {
                const base = COUNTRY_COORDS[country];
                const hash = city.split('').reduce((a, b) => ((a << 5) - a) + b.charCodeAt(0), 0);
                return [base[0] + ((hash % 100) - 50) / 30, base[1] + (((hash >> 8) % 100) - 50) / 30];
            }
            
            return null;
        }
        
        // Map & Data
        let map, markersLayer, polylineLayer;
        let playersList = [];
        let careersData = {};
        let teamIndex = {}; // team -> [{player, years}]
        let currentMarkers = [];
        
        function initMap() {
            map = L.map('map', {
                center: [39.8283, -98.5795],
                zoom: 4,
                zoomControl: true
            });
            
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '¬©OSM ¬©CARTO',
                subdomains: 'abcd',
                maxZoom: 19
            }).addTo(map);
            
            markersLayer = L.layerGroup().addTo(map);
            polylineLayer = L.layerGroup().addTo(map);
        }
        
        function clearMap() {
            markersLayer.clearLayers();
            polylineLayer.clearLayers();
            currentMarkers = [];
        }
        
        function highlightMarker(index) {
            currentMarkers.forEach((m, i) => {
                const el = m.getElement();
                if (el) {
                    if (i === index) {
                        el.classList.add('highlighted');
                    } else {
                        el.classList.remove('highlighted');
                    }
                }
            });
        }
        
        function displayPlayerOnMap(career) {
            clearMap();
            
            const points = [];
            const bounds = [];
            
            career.forEach((stop, index) => {
                const coords = getCoords(stop.city, stop.state, stop.country);
                if (coords) {
                    points.push({ coords, stop, index });
                    bounds.push(coords);
                }
            });
            
            if (points.length === 0) return;
            
            // Draw path
            if (points.length > 1) {
                L.polyline(points.map(p => p.coords), {
                    color: '#fdb927',
                    weight: 3,
                    opacity: 0.8,
                    dashArray: '8, 4'
                }).addTo(polylineLayer);
            }
            
            // Add numbered markers
            points.forEach((point, i) => {
                const isFirst = i === 0;
                const isLast = i === points.length - 1;
                const num = i + 1;
                
                let markerClass = 'numbered-marker';
                let size = 24;
                if (isFirst) {
                    markerClass += ' start';
                    size = 28;
                } else if (isLast) {
                    markerClass += ' end';
                    size = 28;
                }
                
                const icon = L.divIcon({
                    className: markerClass,
                    html: `<span>${num}</span>`,
                    iconSize: [size, size],
                    iconAnchor: [size/2, size/2]
                });
                
                const marker = L.marker(point.coords, { icon });
                marker.addTo(markersLayer);
                currentMarkers.push(marker);
                
                const stopLabel = isFirst ? 'üöÄ FIRST STOP' : (isLast ? 'üèÅ LATEST' : `STOP #${num}`);
                const location = point.stop.state 
                    ? `${point.stop.city}, ${point.stop.state}`
                    : point.stop.city || 'Unknown';
                
                marker.bindPopup(`
                    <div class="popup-content">
                        <div class="popup-stop">${stopLabel}</div>
                        <div class="popup-team">${point.stop.team}</div>
                        <div class="popup-location">${getFlag(point.stop.country)} ${location}${point.stop.country ? ', ' + point.stop.country : ''}</div>
                        <div class="popup-years">${point.stop.years}</div>
                    </div>
                `, { closeButton: false });
                
                // Hover sync
                marker.on('mouseover', () => {
                    document.querySelectorAll('.timeline-item').forEach((el, idx) => {
                        el.classList.toggle('highlighted', idx === point.index);
                    });
                });
                marker.on('mouseout', () => {
                    document.querySelectorAll('.timeline-item').forEach(el => {
                        el.classList.remove('highlighted');
                    });
                });
            });
            
            if (bounds.length > 0) {
                map.fitBounds(bounds, { padding: [40, 40], maxZoom: 6 });
            }
        }
        
        async function loadData() {
            try {
                const playersResponse = await fetch('nba_players_list.csv');
                const playersText = await playersResponse.text();
                playersList = playersText.trim().split('\n').slice(1).map(line => {
                    return line.split(',')[0]?.replace(/"/g, '').trim();
                }).filter(name => name);
                
                const careersResponse = await fetch('nba_players_careers_READY.json');
                const careersArray = await careersResponse.json();
                
                careersArray.forEach(p => {
                    careersData[p.player] = p;
                    
                    // Build team index
                    if (p.career_history) {
                        p.career_history.forEach(stop => {
                            if (!teamIndex[stop.team]) {
                                teamIndex[stop.team] = { players: [], location: stop };
                            }
                            teamIndex[stop.team].players.push({
                                name: p.player,
                                years: stop.years
                            });
                        });
                    }
                });
                
                // Setup suggested players
                setupSuggestions();
                
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }
        
        function setupSuggestions() {
            const available = SUGGESTED_PLAYERS.filter(p => careersData[p]);
            const shuffled = available.sort(() => Math.random() - 0.5);
            
            const chips1 = shuffled.slice(0, 12);
            const chips2 = shuffled.slice(12, 20);
            
            document.getElementById('suggestedChips').innerHTML = chips1.map(p => 
                `<div class="player-chip" onclick="displayPlayer('${p}')">${p}</div>`
            ).join('');
            
            document.getElementById('moreSuggestions').innerHTML = chips2.map(p => 
                `<div class="player-chip" onclick="displayPlayer('${p}')">${p}</div>`
            ).join('');
        }
        
        // Search
        const searchInput = document.getElementById('searchInput');
        const suggestions = document.getElementById('suggestions');
        
        searchInput.addEventListener('input', function() {
            const query = this.value.toLowerCase().trim();
            
            if (query.length < 2) {
                suggestions.classList.remove('active');
                return;
            }
            
            const matches = playersList.filter(name => 
                name.toLowerCase().includes(query)
            ).slice(0, 8);
            
            if (matches.length === 0) {
                suggestions.classList.remove('active');
                return;
            }
            
            suggestions.innerHTML = matches.map(name => 
                `<div class="suggestion-item" data-name="${name}">${name}</div>`
            ).join('');
            suggestions.classList.add('active');
        });
        
        suggestions.addEventListener('click', function(e) {
            if (e.target.classList.contains('suggestion-item')) {
                const name = e.target.dataset.name;
                searchInput.value = name;
                suggestions.classList.remove('active');
                displayPlayer(name);
            }
        });
        
        document.addEventListener('click', function(e) {
            if (!searchInput.contains(e.target) && !suggestions.contains(e.target)) {
                suggestions.classList.remove('active');
            }
        });
        
        searchInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const first = suggestions.querySelector('.suggestion-item');
                if (first) {
                    searchInput.value = first.dataset.name;
                    suggestions.classList.remove('active');
                    displayPlayer(first.dataset.name);
                }
            }
        });
        
        // Display player
        function displayPlayer(name) {
            const player = careersData[name];
            
            if (!player || !player.career_history || player.career_history.length === 0) {
                alert('No career data available for this player.');
                return;
            }
            
            const career = player.career_history;
            
            document.getElementById('welcomeMessage').style.display = 'none';
            document.getElementById('playerInfo').classList.add('active');
            
            document.getElementById('playerName').textContent = name;
            
            const firstYear = career[0].years.split('-')[0];
            const lastYear = career[career.length - 1].years.split('-')[1];
            document.getElementById('playerMeta').textContent = `${firstYear} - ${lastYear}`;
            
            const uniqueTeams = new Set(career.map(c => c.team)).size;
            const uniqueCountries = new Set(career.map(c => c.country).filter(c => c)).size;
            const yearsActive = parseInt(lastYear) - parseInt(firstYear);
            
            document.getElementById('statTeams').textContent = uniqueTeams;
            document.getElementById('statCountries').textContent = uniqueCountries || 1;
            document.getElementById('statYears').textContent = yearsActive > 0 ? yearsActive : 1;
            document.getElementById('statStops').textContent = career.length;
            
            // Timeline with flags and clickable teams
            const timeline = document.getElementById('timeline');
            timeline.innerHTML = career.map((stop, idx) => {
                const location = stop.city 
                    ? (stop.state ? `${stop.city}, ${stop.state}` : stop.city)
                    : 'Unknown location';
                const flag = stop.country ? getFlag(stop.country) : 'üåç';
                const country = stop.country || '';
                const num = idx + 1;
                
                return `
                    <div class="timeline-item" data-index="${idx}" 
                         onmouseenter="highlightMarker(${idx})" 
                         onmouseleave="highlightMarker(-1)">
                        <div class="stop-number">${num}</div>
                        <div class="timeline-content">
                            <div class="timeline-years">${stop.years}</div>
                            <div class="timeline-team" onclick="showTeamModal('${stop.team.replace(/'/g, "\\'")}')">
                                ${flag} ${stop.team}
                            </div>
                            <div class="timeline-location">
                                ${location}${country ? `, ${country}` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            displayPlayerOnMap(career);
            
            // Scroll to top on mobile
            if (window.innerWidth < 768) {
                document.querySelector('.sidebar').scrollTop = 0;
            }
        }
        
        // Team Modal
        function showTeamModal(teamName) {
            const team = teamIndex[teamName];
            if (!team) return;
            
            document.getElementById('modalTeamName').textContent = teamName;
            
            const loc = team.location;
            const locText = loc.city 
                ? `${getFlag(loc.country)} ${loc.city}${loc.state ? ', ' + loc.state : ''}${loc.country ? ', ' + loc.country : ''}`
                : 'Location unknown';
            document.getElementById('modalTeamLocation').textContent = locText;
            
            document.getElementById('modalPlayerCount').textContent = `${team.players.length} players in database`;
            
            // Sort by year descending
            const sorted = [...team.players].sort((a, b) => {
                const yearA = parseInt(a.years.split('-')[0]) || 0;
                const yearB = parseInt(b.years.split('-')[0]) || 0;
                return yearB - yearA;
            });
            
            document.getElementById('modalPlayerList').innerHTML = sorted.slice(0, 50).map(p => `
                <div class="modal-player-item" onclick="closeTeamModal(); displayPlayer('${p.name.replace(/'/g, "\\'")}')">
                    ${p.name}
                    <span class="modal-player-years">${p.years}</span>
                </div>
            `).join('') + (sorted.length > 50 ? `<div style="color: var(--gray); padding: 0.5rem;">...and ${sorted.length - 50} more</div>` : '');
            
            document.getElementById('teamModal').classList.add('active');
        }
        
        function closeTeamModal() {
            document.getElementById('teamModal').classList.remove('active');
        }
        
        // Close modal on overlay click
        document.getElementById('teamModal').addEventListener('click', function(e) {
            if (e.target === this) closeTeamModal();
        });
        
        // Init
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            loadData();
        });
    </script>
</body>
</html>
